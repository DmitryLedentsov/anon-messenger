# Анонимный Мессенджер AnonMessenger

## Table of contents

- [Анонимный Мессенджер AnonMessenger](#анонимный-мессенджер-anonmessenger)
  - [Table of contents](#table-of-contents)
  - [Генерация сертификата для https](#генерация-сертификата-для-https)
  - [Хостинг](#хостинг)
    - [**`Потребление.png`**](#потреблениеpng)
  - [Deploy](#deploy)
    - [In the container](#in-the-container)
  - [Описание предметной области](#описание-предметной-области)
  - [Описание бизнес процессов](#описание-бизнес-процессов)
  - [Стек технологий](#стек-технологий)
  - [Этапы рефакторинга](#этапы-рефакторинга)

## Генерация сертификата для https

```bash
cd messenger/src/main/resources/keystore
keytool -genkeypair -alias messenger -keyalg RSA -keysize 4096 -storetype PKCS12 -keystore messenger.p12 -validity 365
```

## Хостинг

Текущее потребление ресурсов, при запуске без docker:

### **`Потребление.png`**

![Потребление](tests/Потребление.png)

## Deploy

### In the container

```bash
pip install doit # or for WSL: sudo apt install python3-doit

doit build_images

doit container

# inside container in /home/dev

# ignore pg_start errors
doit pg_start
doit pg_fill

doit kafka_run

doit package

# messenger in foreground
doit ms_run -m back
```


For information about commands:

```bash
# list of commands
doit list

# help
doit help ms_run

# info about args
doit info ms_run
```

Если вы хотите запустить сервер на определённом IP-адресе, то надо отредактировать файл *application.properties*, где указываете вместо localhost нужный вам IP-адрес:

```text
messenger.public-url = http://localhost:9087
messenger.websocket.url = ws://localhost:9087/ws
```

## Описание предметной области

Анонимный мессенджер с минимальными данными о пользователе - не хранится никакой личной информации, только логин/пароль. Для пользования мессенджером пользователь регистрируется или заходит под уже созданным аккаунтом.

Для входа нужны:

- Логин
- Пароль

Для регистрации нужны:

- Уникальный никнейм (логин)
- Пароль

После аутентификации и авторизации пользователь имеет следующие возможности:

* Создавать собственные чаты
* Приглашать в свои чаты людей (по логину)
* Писать и просматривать текстовые сообщения
* Банить пользователей в чате (если есть роль админа или создателя чата)
* Создатель чата может назначать админами других пользователей
* Удалять свои чаты вместе со всеми сообщениями
* Удаление аккаунта
* Выход из аккаунта

## Описание бизнес процессов

При входе на сайт пользователю отображается страница для аутентификации и авторизации с полями “Логин” и “Пароль”, а также кнопками “Войти” и “Регистрация”.
Для входа в аккаунт, пользователю нужно будет ввести никнейм (логин) и пароль, а потом нажать “Войти” - данные пройдут валидацию и отправятся на сервер для проверки на наличие таких пользователей в БД.

Если пользователь захочет создать новый аккаунт - ему нужно будет нажать на кнопку “Регистрация”, которая перекинет на страницу для регистрации, ввести уникальный логин (которого ещё не существует), пароль и нажать на кнопку “Зарегистрироваться” - данные провалидируются и отправятся на сервер, где будут проверены (уникальность логина и server-side валидация пароля).

После аутентификации и авторизации пользователя перекинет на основную страницу с списком чатов. Здесь пользователь сможет:

- Создать новый чат
- Читать сообщения в уже существующих чатах
- Удалять чаты
- Выйти из аккаунта
- Удалить аккаунт

При нажатии на чат будут загружаться данные о чате и сообщения пользователей.
В чате пользователь сможет:

- Удалять пользователей (если создатель)
- Просматривать сообщения
- Удалить текущий чат(все свои сообщения)

При создании чата будет отображаться соответствующее окно с следующими полями:

- Название чата (Не обязательно уникальное)
- Список людей, которых пользователь собирается пригласить
- Строка поиска, для поиска людей по никнейму

## Стек технологий

Backend: Spring+PostgreSQL

Frontend: Js(Jquery) + Websockets

## Этапы рефакторинга

- <strike>Внедрение шифрования по алгоритму ГОСТ</strike>
- Переделать под SPA(все на одной странице)
- Минимизировать и нормализовать базу данных
